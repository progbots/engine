System.register("index",[],(function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){!function(e){e.boolean="booleantype",e.integer="integertype",e.string="stringtype",e.name="nametype",e.call="calltype",e.operator="operatortype",e.mark="marktype",e.array="arraytype",e.dict="dicttype",e.proc="proctype"}(r||(r={})),e("ValueType",r)}}})),System.register("state/parser",["index"],(function(e,t){"use strict";var r;t&&t.id;return e("parse",(function*parse(e,t){const n=/%[^\n]*|(?:"([^"]*)")|\s+|((?:-|\+)?\d+)|\/(\S+)|(\[|\]|{|}|[^[\]{}}\s]+)/g;let o=n.exec(e);for(;null!==o;){const[,s,a,i,c]=o,u={type:r.ValueType.integer,data:0,source:e,sourcePos:o.index};void 0!==t&&(u.sourceFile=t),void 0!==s?yield{...u,type:r.ValueType.string,data:s}:void 0!==a?yield{...u,type:r.ValueType.integer,data:parseInt(a,10)}:void 0!==i?yield{...u,type:r.ValueType.name,data:i}:void 0!==c&&(yield{...u,type:r.ValueType.call,data:c}),o=n.exec(e)}})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("errors/BaseError",[],(function(e,t){"use strict";var r;t&&t.id;return{setters:[],execute:function(){r=class BaseError extends Error{constructor(e){super(e),this._callstack="",this.name=this.constructor.name}get callstack(){return""!==this._callstack?this._callstack:this.stack?.split("\n").slice(1).join("\n")??""}set callstack(e){""===this._callstack&&(this._callstack=e)}},e("BaseError",r)}}})),System.register("errors/Break",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class Break extends r.BaseError{constructor(){super("break")}},e("Break",n)}}})),System.register("errors/BusyParsing",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class BusyParsing extends r.BaseError{constructor(){super("The engine is already parsing a source")}},e("BusyParsing",n)}}})),System.register("errors/DictStackUnderflow",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class DictStackUnderflow extends r.BaseError{constructor(){super("An attempt has been made to remove (end) the bottommost instance of userdict from the dictionary stack but no corresponding add (begin) exists")}},e("DictStackUnderflow",n)}}})),System.register("errors/Internal",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class Internal extends r.BaseError{set callstack(e){}},e("Internal",n)}}})),System.register("errors/InvalidAccess",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class InvalidAccess extends r.BaseError{constructor(){super("access attribute violated (e.g. attempted to write a read-only object)")}},e("InvalidAccess",n)}}})),System.register("errors/InvalidBreak",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class InvalidBreak extends r.BaseError{constructor(){super("a break has been invoked for which there is no dynamically enclosing looping context")}},e("InvalidBreak",n)}}})),System.register("errors/RangeCheck",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class RangeCheck extends r.BaseError{constructor(){super("operand is too big or too small")}},e("RangeCheck",n)}}})),System.register("errors/StackUnderflow",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class StackUnderflow extends r.BaseError{constructor(){super("you tried to pop from an empty stack")}},e("StackUnderflow",n)}}})),System.register("errors/TypeCheck",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class TypeCheck extends r.BaseError{constructor(){super("operand is of the wrong type")}},e("TypeCheck",n)}}})),System.register("errors/Undefined",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class Undefined extends r.BaseError{constructor(){super("name is not defined in any dictionary on the stack")}},e("Undefined",n)}}})),System.register("errors/UnmatchedMark",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class UnmatchedMark extends r.BaseError{constructor(){super("mark object was not found in the stack")}},e("UnmatchedMark",n)}}})),System.register("errors/VMerror",["errors/BaseError"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class VMError extends r.BaseError{constructor(){super("virtual memory full")}},e("VMError",n)}}})),System.register("errors/index",["errors/Break","errors/BusyParsing","errors/DictStackUnderflow","errors/Internal","errors/InvalidAccess","errors/InvalidBreak","errors/RangeCheck","errors/StackUnderflow","errors/TypeCheck","errors/Undefined","errors/UnmatchedMark","errors/VMerror"],(function(e,t){"use strict";t&&t.id;function exportStar_1(t){var r={};for(var n in t)"default"!==n&&(r[n]=t[n]);e(r)}return{setters:[function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)},function(e){exportStar_1(e)}],execute:function(){}}})),System.register("objects/ShareableObject",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("ShareableObject",class ShareableObject{static addRef(e){Array.isArray(e)?e.forEach((e=>{e.data instanceof ShareableObject&&e.data.addRef()})):e.data instanceof ShareableObject&&e.data.addRef()}static release(e){Array.isArray(e)?e.forEach((e=>{e.data instanceof ShareableObject&&e.data.release()})):e.data instanceof ShareableObject&&e.data.release()}constructor(){this._refCount=1}get refCount(){return this._refCount}addRef(){++this._refCount}release(){0==--this._refCount&&this._dispose()}})}}})),System.register("state/MemoryTracker",["index","errors/index"],(function(e,t){"use strict";var r,n,o,s;t&&t.id;function isString(e){return[r.ValueType.string,r.ValueType.name,r.ValueType.call].includes(e.type)}function isShareableObject(e){return[r.ValueType.array,r.ValueType.proc,r.ValueType.dict].includes(e.type)}return{setters:[function(e){r=e},function(e){n=e}],execute:function(){o=e=>(new TextEncoder).encode(e).length+1,(s=class MemoryTracker{_addStringRef(e){const t=e.data,r=o(t);if(t.length>=MemoryTracker.CACHABLE_STRING_LENGTH){const e=this._strings.indexOf(t);return-1===e?(this._strings.push(t),this._stringsRefCount.push(1),r+MemoryTracker.INTEGER_SIZE):(++this._stringsRefCount[e],0)}return r}_releaseString(e){const t=e.data,r=o(t);if(t.length>=MemoryTracker.CACHABLE_STRING_LENGTH){const e=this._strings.indexOf(t);return 0===--this._stringsRefCount[e]?r+MemoryTracker.INTEGER_SIZE:0}return r}constructor(e=1/0){this._total=e,this._used=0,this._strings=[],this._stringsRefCount=[]}get used(){return this._used}get total(){return this._total}addValueRef(e){let t=MemoryTracker.VALUE_SIZE;if(!0!==e.untracked)if(isString(e))t+=this._addStringRef(e);else if(isShareableObject(e)){e.data.addRef()}this.increment(t)}releaseValue(e){let t=MemoryTracker.VALUE_SIZE;if(!0!==e.untracked)if(isString(e))t+=this._releaseString(e);else if(isShareableObject(e)){e.data.release()}this.decrement(t)}increment(e){if(this._used+=e,this._used>this._total)throw new n.VMError}decrement(e){this._used-=e}}).POINTER_SIZE=4,s.INTEGER_SIZE=4,s.VALUE_TYPE_SIZE=1,s.VALUE_SIZE=s.VALUE_TYPE_SIZE+s.POINTER_SIZE,s.CACHABLE_STRING_LENGTH=32,e("MemoryTracker",s)}}})),System.register("objects/BaseArray",["objects/ShareableObject","state/MemoryTracker","errors/index"],(function(e,t){"use strict";var r,n,o,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){(s=class BaseArray extends r.ShareableObject{constructor(e){super(),this._memoryTracker=e,this._values=[],this._memoryTracker.increment(BaseArray.INITIAL_SIZE)}get length(){return this._values.length}at(e){const t=this._values[e];if(void 0===t)throw new o.RangeCheck;return Object.assign({},t)}addValueRef(e){this._memoryTracker.addValueRef(e),this._memoryTracker.increment(BaseArray.VALUE_ADDITIONAL_SIZE)}push(e){this.addValueRef(e),this.pushImpl(e)}releaseValue(e){this._memoryTracker.releaseValue(e),this._memoryTracker.decrement(BaseArray.VALUE_ADDITIONAL_SIZE)}pop(){if(0===this._values.length)throw new o.StackUnderflow;const e=this.popImpl();this.releaseValue(e)}get ref(){return this._values}_dispose(){for(;this._values.length>0;)this.pop();this._memoryTracker.decrement(BaseArray.INITIAL_SIZE)}}).INITIAL_SIZE=n.MemoryTracker.POINTER_SIZE,s.VALUE_ADDITIONAL_SIZE=n.MemoryTracker.POINTER_SIZE,e("BaseArray",s)}}})),System.register("objects/Stack",["objects/BaseArray"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n=class Stack extends r.BaseArray{pushImpl(e){this._values.unshift(e)}popImpl(){return this._values.shift()}},e("Stack",n)}}})),System.register("objects/dictionaries/types",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}})),System.register("objects/dictionaries/Dictionary",["index","state/MemoryTracker","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o,s;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){(s=class Dictionary extends o.ShareableObject{constructor(e){super(),this._memoryTracker=e,this._values={},this._memoryTracker.increment(Dictionary.INITIAL_SIZE)}get names(){return Object.keys(this._values)}lookup(e){const t=this._values[e];return void 0===t?null:t}def(e,t){const n=this._values[e];void 0!==n?this._memoryTracker.releaseValue(n):(this._memoryTracker.addValueRef({type:r.ValueType.string,data:e}),this._memoryTracker.increment(Dictionary.VALUE_ADDITIONAL_SIZE)),this._memoryTracker.addValueRef(t),this._values[e]=t}_dispose(){this.names.forEach((e=>{const t=this._values[e];this._memoryTracker.releaseValue(t),this._memoryTracker.releaseValue({type:r.ValueType.string,data:e}),this._memoryTracker.decrement(Dictionary.VALUE_ADDITIONAL_SIZE)})),this._memoryTracker.decrement(Dictionary.INITIAL_SIZE)}}).INITIAL_SIZE=n.MemoryTracker.POINTER_SIZE,s.VALUE_ADDITIONAL_SIZE=3*n.MemoryTracker.POINTER_SIZE,e("Dictionary",s)}}})),System.register("objects/dictionaries/Host",["objects/ShareableObject","errors/index"],(function(e,t){"use strict";var r,n,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){o=class HostDictionary extends r.ShareableObject{get names(){return this._hostDictionary.names}lookup(e){return this._hostDictionary.lookup(e)}def(e,t){throw new n.InvalidAccess}constructor(e){super(),this._hostDictionary=e}_dispose(){}},e("HostDictionary",o)}}})),System.register("operators/operands",["index","errors/index"],(function(e,t){"use strict";var r,n;t&&t.id;return e("checkOperands",(function checkOperands(e,...t){const r=e.operandsRef;if(t.length>r.length)throw new n.StackUnderflow;return t.map(((e,t)=>{const o=r[t];if(null!==e&&o.type!==e)throw new n.TypeCheck;return o}))})),e("findMarkPos",(function findMarkPos(e){const t=e.operandsRef.findIndex((e=>e.type===r.ValueType.mark));if(-1===t)throw new n.UnmatchedMark;return t})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/add",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("add",(function*add(e){const[t,o]=n.checkOperands(e,r.ValueType.integer,r.ValueType.integer).map((e=>e.data));e.pop(),e.pop(),e.push({type:r.ValueType.integer,data:t+o})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("objects/Array",["errors/index","objects/BaseArray"],(function(e,t){"use strict";var r,n,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){o=class ArrayLike extends n.BaseArray{pushImpl(e){this._values.push(e)}popImpl(){const e=this._values.at(-1);return this._values.pop(),e}shift(){const e=this._values.shift();if(void 0===e)throw new r.Internal("array is empty");return this.releaseValue(e),e}unshift(e){this.addValueRef(e),this._values.unshift(e)}set(e,t){if(e<0)throw new r.RangeCheck;const n=this._values[e];this.addValueRef(t),void 0!==n&&this.releaseValue(n),this._values[e]=t}},e("ArrayLike",o)}}})),System.register("operators/aload",["index","operators/operands","errors/index"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("aload",(function*aload(e){const[{type:t,data:s}]=n.checkOperands(e,null);if(![r.ValueType.array,r.ValueType.proc].includes(t))throw new o.TypeCheck;const a=s,{length:i}=a;a.addRef();try{e.pop();for(let t=0;t<i;++t){const r=a.at(t);e.push(r)}}finally{a.release()}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("operators/begin",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("begin",(function*begin(e){const[t]=n.checkOperands(e,r.ValueType.dict);e.begin(t.data),e.pop()})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/bind",["index","errors/index","operators/operands"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("bind",(function*bind(e){const[t]=o.checkOperands(e,r.ValueType.proc),s=[t.data];let a=0;for(;a<s.length;){const t=s[a];for(let o=0;o<t.ref.length;++o){const a=t.at(o);if(a.type===r.ValueType.call){yield;try{const r=e.lookup(a.data);t.set(o,{...a,...r})}catch(e){if(!(e instanceof n.Undefined))throw e}}else a.type===r.ValueType.proc&&s.push(a.data)}++a}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("operators/clear",[],(function(e,t){"use strict";t&&t.id;return e("clear",(function*clear(e){const t=e.operandsRef;for(;t.length>0;)e.pop()})),{setters:[],execute:function(){}}})),System.register("operators/cleartomark",["operators/operands"],(function(e,t){"use strict";var r;t&&t.id;return e("cleartomark",(function*cleartomark(e){let t=r.findMarkPos(e);for(;t>=0;)e.pop(),--t})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/open-close-helper",["index","objects/Array","operators/operands"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("openWithMark",(function openWithMark(e){const t=e.callsRef[0];e.push({...t,type:r.ValueType.mark,data:null})})),e("closeToMark",(function closeToMark(e,t){const r=o.findMarkPos(e),s=e.operandsRef[r],a=e.operandsRef,i=new n.ArrayLike(e.memoryTracker);try{let n;for(n=0;n<r;++n)i.unshift(a[n]);for(n=0;n<=r;++n)e.pop();e.push({...s,type:t,data:i})}finally{i.release()}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("operators/close-array",["index","operators/open-close-helper"],(function(e,t){"use strict";var r,n;t&&t.id;function*closeArray(e){n.closeToMark(e,r.ValueType.array)}return e("closeArray",closeArray),{setters:[function(e){r=e},function(e){n=e}],execute:function(){Object.defineProperty(closeArray,"name",{value:"]",writable:!1})}}})),System.register("operators/close-proc",["index","operators/open-close-helper"],(function(e,t){"use strict";var r,n;t&&t.id;function*closeProc(e){n.closeToMark(e,r.ValueType.proc),e.allowCall()}return e("closeProc",closeProc),{setters:[function(e){r=e},function(e){n=e}],execute:function(){Object.defineProperty(closeProc,"name",{value:"}",writable:!1})}}})),System.register("operators/count",["index"],(function(e,t){"use strict";var r;t&&t.id;return e("count",(function*count(e){e.push({type:r.ValueType.integer,data:e.operandsRef.length})})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/counttomark",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("counttomark",(function*counttomark(e){const t=n.findMarkPos(e);e.push({type:r.ValueType.integer,data:t})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/currentdict",[],(function(e,t){"use strict";t&&t.id;return e("currentdict",(function*currentdict(e){e.push(e.dictionariesRef[0])})),{setters:[],execute:function(){}}})),System.register("operators/def",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("def",(function*def(e){const[t,o]=n.checkOperands(e,null,r.ValueType.name),[{data:s}]=e.dictionariesRef;s.def(o.data,t),e.pop(),e.pop()})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/dict",["index","objects/dictionaries/index"],(function(e,t){"use strict";var r,n;t&&t.id;return e("dict",(function*dict(e){const t=new n.Dictionary(e.memoryTracker);e.push({type:r.ValueType.dict,data:t}),t.release()})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/dictstack",["objects/Array","index"],(function(e,t){"use strict";var r,n;t&&t.id;return e("dictstack",(function*dictstack(e){const t=new r.ArrayLike(e.memoryTracker),o=e.dictionariesRef;try{for(const e of o)t.push(e);e.push({type:n.ValueType.array,data:t})}finally{t.release()}})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/end",[],(function(e,t){"use strict";t&&t.id;return e("end",(function*end(e){e.end()})),{setters:[],execute:function(){}}})),System.register("operators/eq",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("eq",(function*eq(e){const[t,o]=n.checkOperands(e,null,null),s=t.type===o.type&&t.data===o.data;e.pop(),e.pop(),e.push({type:r.ValueType.boolean,data:s})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/exch",["operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n;t&&t.id;return e("exch",(function*exch(e){const[t,o]=r.checkOperands(e,null,null);n.ShareableObject.addRef([t,o]);try{e.pop(),e.pop(),e.push(t),e.push(o)}finally{n.ShareableObject.release([t,o])}})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/dup",["operators/operands"],(function(e,t){"use strict";var r;t&&t.id;return e("dup",(function*dup(e){const[t]=r.checkOperands(e,null);e.push(t)})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/false",["index"],(function(e,t){"use strict";var r;t&&t.id;function*falseOp(e){e.push({type:r.ValueType.boolean,data:!1})}return e("falseOp",falseOp),{setters:[function(e){r=e}],execute:function(){Object.defineProperty(falseOp,"name",{value:"false",writable:!1})}}})),System.register("operators/get",["index","errors/index","operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o,s,a;t&&t.id;function arrayLikeGetter(e){const[t,o]=e.operandsRef;if(t.type!==r.ValueType.integer)throw new n.TypeCheck;const s=t.data;return o.data.at(s)}return e("get",(function*get(e){const[,t]=o.checkOperands(e,null,null),r=a[t.type];if(void 0===r)throw new n.TypeCheck;s.ShareableObject.addRef(t);try{const t=r(e);e.pop(),e.pop(),e.push(t)}finally{s.ShareableObject.release(t)}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){a={[r.ValueType.string]:e=>{const[t,o]=e.operandsRef;if(t.type!==r.ValueType.integer)throw new n.TypeCheck;const s=t.data,a=o.data;if(s<0||s>=a.length)throw new n.RangeCheck;return{type:r.ValueType.integer,data:a.charCodeAt(s)}},[r.ValueType.array]:arrayLikeGetter,[r.ValueType.dict]:e=>{const[t,o]=e.operandsRef;if(t.type!==r.ValueType.name)throw new n.TypeCheck;const s=t.data,a=o.data.lookup(s);if(null===a)throw new n.Undefined;return a},[r.ValueType.proc]:arrayLikeGetter}}}})),System.register("operators/globaldict",["index"],(function(e,t){"use strict";var r;t&&t.id;return e("globaldict",(function*globaldict(e){e.push({type:r.ValueType.dict,data:e.globaldict})})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/if",["index","operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o;t&&t.id;function*ifOp(e){const[t,s]=n.checkOperands(e,r.ValueType.proc,r.ValueType.boolean);o.ShareableObject.addRef(t);try{e.pop(),e.pop(),s.data&&(yield*e.eval(t))}finally{o.ShareableObject.release(t)}}return e("ifOp",ifOp),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){Object.defineProperty(ifOp,"name",{value:"if",writable:!1})}}})),System.register("operators/ifelse",["index","operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("ifelse",(function*ifelse(e){const[t,s,a]=n.checkOperands(e,r.ValueType.proc,r.ValueType.proc,r.ValueType.boolean);o.ShareableObject.addRef([s,t]);try{e.pop(),e.pop(),e.pop(),a.data?yield*e.eval(s):yield*e.eval(t)}finally{o.ShareableObject.release([s,t])}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("operators/index-op",["operators/operands","index","errors/index"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("index",(function*index(e){const[t]=r.checkOperands(e,n.ValueType.integer).map((e=>e.data));if(t<0)throw new o.RangeCheck;const s=e.operandsRef;if(t+1>=s.length)throw new o.StackUnderflow;e.pop();const a=s[t];e.push(a)})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("operators/length",["index","errors/index","operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o,s,a;t&&t.id;function arrayLikeLength(e){return e.data.length}return e("length",(function*length(e){const[t]=o.checkOperands(e,null),i=a[t.type];if(void 0===i)throw new n.TypeCheck;s.ShareableObject.addRef(t);try{const n=i(t);e.pop(),e.push({type:r.ValueType.integer,data:n})}finally{s.ShareableObject.release(t)}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){a={[r.ValueType.string]:e=>e.data.length,[r.ValueType.array]:arrayLikeLength,[r.ValueType.dict]:e=>e.data.names.length,[r.ValueType.proc]:arrayLikeLength}}}})),System.register("operators/loop",["index","errors/index","objects/ShareableObject","operators/operands"],(function(e,t){"use strict";var r,n,o,s;t&&t.id;function*loop(e){const[t]=s.checkOperands(e,r.ValueType.proc);o.ShareableObject.addRef(t);try{for(e.pop();;)yield*e.eval(t)}catch(e){if(!(e instanceof n.Break))throw e}finally{o.ShareableObject.release(t)}}return e("loop",loop),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){Object.defineProperty(loop,"breakable",{value:!0,writable:!1})}}})),System.register("operators/mark",["index"],(function(e,t){"use strict";var r;t&&t.id;return e("mark",(function*mark(e){e.push({type:r.ValueType.mark,data:null})})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/neq",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("neq",(function*neq(e){const[t,o]=n.checkOperands(e,null,null),s=t.type!==o.type||t.data!==o.data;e.pop(),e.pop(),e.push({type:r.ValueType.boolean,data:s})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/open-array",["operators/open-close-helper"],(function(e,t){"use strict";var r;t&&t.id;function*openArray(e){r.openWithMark(e)}return e("openArray",openArray),{setters:[function(e){r=e}],execute:function(){Object.defineProperty(openArray,"name",{value:"[",writable:!1})}}})),System.register("operators/open-proc",["operators/open-close-helper"],(function(e,t){"use strict";var r;t&&t.id;function*openProc(e){r.openWithMark(e),e.preventCall()}return e("openProc",openProc),{setters:[function(e){r=e}],execute:function(){Object.defineProperty(openProc,"name",{value:"{",writable:!1})}}})),System.register("operators/pop",["operators/operands"],(function(e,t){"use strict";var r;t&&t.id;return e("pop",(function*pop(e){r.checkOperands(e,null),e.pop()})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/roll",["index","operators/operands","objects/ShareableObject","errors/index"],(function(e,t){"use strict";var r,n,o,s;t&&t.id;return e("roll",(function*roll(e){const[t,a]=n.checkOperands(e,r.ValueType.integer,r.ValueType.integer).map((e=>e.data));if(e.operandsRef.length<a+2)throw new s.StackUnderflow;const i=e.operandsRef.slice(2,2+a).reverse();o.ShareableObject.addRef(i);try{let r;for(e.pop(),e.pop(),r=0;r<a;++r)e.pop();for(r=0;r<a;++r)e.push(i[(a+r-t)%a])}finally{o.ShareableObject.release(i)}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){}}})),System.register("operators/set",["index","errors/index","operators/operands","objects/ShareableObject"],(function(e,t){"use strict";var r,n,o,s,a;t&&t.id;return e("set",(function*set(e){const[,,t]=o.checkOperands(e,null,null,null),r=a[t.type];if(void 0===r)throw new n.TypeCheck;s.ShareableObject.addRef(t);try{const t=r(e);e.pop(),e.pop(),e.pop(),e.push(t)}finally{s.ShareableObject.release(t)}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){a={[r.ValueType.string]:e=>{const[t,o,s]=e.operandsRef;if(o.type!==r.ValueType.integer||t.type!==r.ValueType.integer)throw new n.TypeCheck;const a=o.data,i=s.data;if(a<0||a>=i.length)throw new n.RangeCheck;const c=[];return a>0&&c.push(i.substring(0,a)),c.push(String.fromCharCode(t.data)),a+1<i.length&&c.push(i.substring(a+1)),{type:r.ValueType.string,data:c.join("")}},[r.ValueType.array]:e=>{const[t,o,s]=e.operandsRef;if(o.type!==r.ValueType.integer)throw new n.TypeCheck;const a=o.data,i=s.data;if(a>=i.length)throw new n.RangeCheck;return i.set(a,t),s},[r.ValueType.dict]:e=>{const[t,o,s]=e.operandsRef;if(o.type!==r.ValueType.name)throw new n.TypeCheck;const a=o.data;return s.data.def(a,t),s}}}}})),System.register("operators/sub",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("sub",(function*sub(e){const[t,o]=n.checkOperands(e,r.ValueType.integer,r.ValueType.integer).map((e=>e.data));e.pop(),e.pop(),e.push({type:r.ValueType.integer,data:o-t})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/systemdict",["index"],(function(e,t){"use strict";var r;t&&t.id;return e("systemdict",(function*systemdict(e){e.push({type:r.ValueType.dict,data:e.systemdict})})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("operators/true",["index"],(function(e,t){"use strict";var r;t&&t.id;function*trueOp(e){e.push({type:r.ValueType.boolean,data:!0})}return e("trueOp",trueOp),{setters:[function(e){r=e}],execute:function(){Object.defineProperty(trueOp,"name",{value:"true",writable:!1})}}})),System.register("operators/type",["index","operators/operands"],(function(e,t){"use strict";var r,n;t&&t.id;return e("type",(function*type(e){const[{type:t}]=n.checkOperands(e,null);e.pop(),e.push({type:r.ValueType.string,data:t})})),{setters:[function(e){r=e},function(e){n=e}],execute:function(){}}})),System.register("operators/index",["operators/add","operators/aload","operators/begin","operators/bind","operators/clear","operators/cleartomark","operators/close-array","operators/close-proc","operators/count","operators/counttomark","operators/currentdict","operators/def","operators/dict","operators/dictstack","operators/end","operators/eq","operators/exch","operators/dup","operators/false","operators/get","operators/globaldict","operators/if","operators/ifelse","operators/index-op","operators/length","operators/loop","operators/mark","operators/neq","operators/open-array","operators/open-proc","operators/pop","operators/roll","operators/set","operators/sub","operators/systemdict","operators/true","operators/type"],(function(e,t){"use strict";t&&t.id;function exportStar_2(t){var r={};for(var n in t)"default"!==n&&(r[n]=t[n]);e(r)}return{setters:[function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)},function(e){exportStar_2(e)}],execute:function(){}}})),System.register("operators/errors",["errors/index"],(function(e,t){"use strict";var r,n;t&&t.id;return{setters:[function(e){r=e}],execute:function(){n={},Object.values(r).forEach((e=>{if(["Internal","BusyParsing"].includes(e.name))return;const t=e,operator=function*(e){throw new t};Object.defineProperty(operator,"name",{value:e.name.toLowerCase(),writable:!1}),n[operator.name]=operator})),e("default",n)}}})),System.register("objects/dictionaries/System",["index","objects/ShareableObject","errors/index","operators/index","operators/errors"],(function(e,t){"use strict";var r,n,o,s,a,i,c;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e},function(e){a=e}],execute:function(){i={},Object.values(s).forEach((e=>{i[e.name]=e})),Object.values(a.default).forEach((e=>{i[e.name]=e})),c=class SystemDictionary extends n.ShareableObject{get names(){return Object.keys(i)}lookup(e){const t=i[e];return void 0===t?null:{type:r.ValueType.operator,data:t}}def(e,t){throw new o.InvalidAccess}_dispose(){}},e("SystemDictionary",c)}}})),System.register("objects/dictionaries/index",["objects/dictionaries/Dictionary","objects/dictionaries/Host","objects/dictionaries/System","objects/dictionaries/types"],(function(e,t){"use strict";t&&t.id;function exportStar_3(t){var r={};for(var n in t)"default"!==n&&(r[n]=t[n]);e(r)}return{setters:[function(e){exportStar_3(e)},function(e){exportStar_3(e)},function(e){exportStar_3(e)},function(e){exportStar_3(e)}],execute:function(){}}})),System.register("formatters",["index","objects/dictionaries/index"],(function(e,t){"use strict";var r,n,o;t&&t.id;return{setters:[function(e){r=e},function(e){n=e}],execute:function(){e("formatters",o={[r.ValueType.boolean]:e=>e.data?"true":"false",[r.ValueType.integer]:e=>e.data.toString(),[r.ValueType.string]:e=>JSON.stringify(e.data),[r.ValueType.name]:e=>`/${e.data}`,[r.ValueType.call]:e=>e.data,[r.ValueType.operator]:e=>`-${e.data.name}-`,[r.ValueType.mark]:e=>"--mark--",[r.ValueType.array]:e=>{const t=["["],r=e.data,{length:n}=r;for(let e=0;e<n;++e){const n=r.at(e);t.push(o[n.type](n))}return t.push("]"),t.join(" ")},[r.ValueType.dict]:e=>{const t=e.data;return e.data instanceof n.HostDictionary?`--hostdict(${t.names.length.toString()})--`:e.data instanceof n.SystemDictionary?`--systemdict(${t.names.length.toString()})--`:`--dictionary(${t.names.length.toString()})--`},[r.ValueType.proc]:e=>{const t=["{"],r=e.data,{length:n}=r;for(let e=0;e<n;++e){const n=r.at(e);t.push(o[n.type](n))}return t.push("}"),t.join(" ")}})}}})),System.register("state/callstack",["index","formatters","state/parser","errors/index"],(function(e,t){"use strict";var r,n,o,s,a,i;t&&t.id;function stringify(e){return JSON.stringify(e.replace(/\r?\n/g,"\u21b5").replace(/\t/g,"\u2b72"))}return e("renderCallStack",(function renderCallStack(e){const{length:t}=e,n=[];let o;for(let s=0;s<t;++s){const t=e.at(s);if(t.type===r.ValueType.integer){o=t.data;continue}let a="";const{sourceFile:c,sourcePos:u}=t;void 0!==c&&void 0!==u&&(a=` @${c}:${u.toString()}`);const l=i[t.type](t,o);n.push(l+a),o=void 0}return n.join("\n")})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e}],execute:function(){"\u00bb","\u00ab",a=e=>`/!\\ unexpected stack item type ${e.type}`,i={[r.ValueType.boolean]:a,[r.ValueType.integer]:a,[r.ValueType.string]:(e,t)=>{const r=e.data;if(void 0!==t){const e=r.substring(0,t),a=o.parse(r.substring(t)),{value:i}=a.next();if(void 0===i)throw new s.Internal("Unexpected parser failure");const c=n.formatters[i.type](i);return stringify(`${e}\u00bb${c}\u00ab${r.substring(t+c.length)}`)}return stringify(r)},[r.ValueType.name]:a,[r.ValueType.call]:e=>n.formatters[e.type](e),[r.ValueType.operator]:(e,t)=>{const r=n.formatters[e.type](e);return void 0!==t?`${r}:${t}`:r},[r.ValueType.mark]:a,[r.ValueType.array]:a,[r.ValueType.dict]:a,[r.ValueType.proc]:(e,t)=>{const r=["{"],o=e.data,{length:s}=o;for(let e=0;e<s;++e){const s=o.at(e);t===e?r.push("\u00bb"+n.formatters[s.type](s)+"\u00ab"):r.push(n.formatters[s.type](s))}return r.push("}"),r.join(" ")}}}}})),System.register("state/State",["index","errors/index","state/index","objects/Stack","state/MemoryTracker","objects/dictionaries/index","objects/dictionaries/Host","errors/BaseError","state/callstack"],(function(e,t){"use strict";var r,n,o,s,a,i,c,u,l;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e},function(e){a=e},function(e){i=e},function(e){c=e},function(e){u=e},function(e){l=e}],execute:function(){e("State",class State{constructor(e={}){this._systemdict=new i.SystemDictionary,this._keepDebugInfo=!1,this._noCall=0,this._memoryTracker=new a.MemoryTracker(e.maxMemoryBytes),this._dictionaries=new s.Stack(this._memoryTracker),this._globaldict=new i.Dictionary(this._memoryTracker),null!=e.hostDictionary&&this.begin(new c.HostDictionary(e.hostDictionary)),!0===e.keepDebugInfo&&(this._keepDebugInfo=!0),this.begin(this._systemdict),this.begin(this._globaldict),this._minDictCount=this._dictionaries.length,this._operands=new s.Stack(this._memoryTracker),this._calls=new s.Stack(this._memoryTracker)}get usedMemory(){return this._memoryTracker.used}get totalMemory(){return this._memoryTracker.total}get operands(){return this._operands}get dictionaries(){return this._dictionaries}get calls(){return this._calls}*parse(e,t){if(0!==this._calls.length)throw new n.BusyParsing;yield*this.innerParse(e,t)}get memoryTracker(){return this._memoryTracker}get keepDebugInfo(){return this._keepDebugInfo}get systemdict(){return this._systemdict}get globaldict(){return this._globaldict}get operandsRef(){return this._operands.ref}get callsRef(){return this._calls.ref}pop(){this._operands.pop()}push(e){this._operands.push(e)}get dictionariesRef(){return this._dictionaries.ref}lookup(e){for(const t of this._dictionaries.ref){const r=t.data.lookup(e);if(null!==r)return r}throw new n.Undefined}begin(e){this._dictionaries.push({type:r.ValueType.dict,data:e})}end(){if(this._dictionaries.ref.length===this._minDictCount)throw new n.DictStackUnderflow;this._dictionaries.pop()}preventCall(){++this._noCall}allowCall(){--this._noCall}*wrapCall(e,t){this._calls.push(e),yield;try{yield*t.apply(this)}catch(e){throw e instanceof u.BaseError&&(e.callstack=l.renderCallStack(this.calls)),e}finally{this._calls.pop()}}*evalCall(e){yield*this.wrapCall(e,(function*(){let t=this.lookup(e.data);t.type===r.ValueType.operator&&this._keepDebugInfo&&(t={...e,...t}),yield*this.eval(t)}))}*evalOperator(e){yield*this.wrapCall(e,(function*(){const t=e.data;yield*t(this)}))}*evalProc(e){yield*this.wrapCall(e,(function*(){const t=e.data,{length:n}=t;for(let e=0;e<n;++e){this._calls.push({type:r.ValueType.integer,data:e});try{yield*this.evalWithoutProc(t.at(e))}finally{this._calls.pop()}}}))}*evalWithoutProc(e){e.type!==r.ValueType.call||0!==this._noCall&&!["{","}"].includes(e.data)?e.type===r.ValueType.operator?yield*this.evalOperator(e):(yield,this.push(e)):yield*this.evalCall(e)}*eval(e){try{e.type===r.ValueType.proc&&0===this._noCall?yield*this.evalProc(e):yield*this.evalWithoutProc(e)}catch(e){if(e instanceof n.Break&&!this._calls.ref.some((({type:e,data:t})=>e===r.ValueType.operator&&!0===t.breakable))){const t=new n.InvalidBreak;throw t.callstack=e.callstack,t}throw e}}*innerParse(e,t){yield*this.wrapCall({type:r.ValueType.string,data:e,untracked:!0,sourceFile:t,sourcePos:0},(function*(){const n=o.parse(e,t);for(const e of n){this._calls.push({type:r.ValueType.integer,data:e.sourcePos});try{let t;if(yield,this._keepDebugInfo)t=e;else{const{type:r,data:n}=e;t={type:r,data:n}}yield*this.eval(t)}finally{this._calls.pop()}}}))}})}}})),System.register("state/types",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}})),System.register("state/index",["state/parser","state/State","state/types"],(function(e,t){"use strict";t&&t.id;function exportStar_4(t){var r={};for(var n in t)"default"!==n&&(r[n]=t[n]);e(r)}return{setters:[function(e){exportStar_4(e)},function(e){exportStar_4(e)},function(e){exportStar_4(e)}],execute:function(){}}})),System.register("factory",["state/index"],(function(e,t){"use strict";var r;t&&t.id;return e("createState",(function createState(e){return new r.State(e)})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("iterators",[],(function(e,t){"use strict";t&&t.id;return e("length",(function length(e){let t=0,{done:r}=e.next();for(;!1===r;)++t,r=e.next().done;return t})),{setters:[],execute:function(){}}})),System.register("utf8toansii",["node:fs/promises"],(function(e,t){"use strict";var r;t&&t.id;return{setters:[function(e){r=e}],execute:function(){(async function main(e){const t=(await r.readFile(e)).toString().replace(/[^\r\n\t -~]/g,(e=>`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`));await r.writeFile(e,t)})(process.argv[2]).then((()=>console.log("done."))).catch((e=>console.error(e)))}}})),System.register("repl/colors",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("red","\u270ered"),e("green","\u270egreen"),e("yellow","\u270eyellow"),e("blue","\u270eblue"),e("magenta","\u270emagenta"),e("cyan","\u270ecyan"),e("white","\u270ewhite")}}})),System.register("repl/forEach",["repl/colors"],(function(e,t){"use strict";var r;t&&t.id;return e("forEach",(function forEach(e,t){const{length:n}=e;let o=1;n>10&&++o,n>100&&++o;for(let s=0;s<n;++s){const n=`${r.blue}${s.toString().padStart(o," ")}${r.white}`;t(e.at(s),n)}})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("repl/replHost",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){}}})),System.register("repl/signals",[],(function(e,t){"use strict";t&&t.id;return{setters:[],execute:function(){e("$state",Symbol("state")),e("$debug",Symbol("debug")),e("$load",Symbol("load"))}}})),System.register("repl/host/debug",["repl/signals"],(function(e,t){"use strict";var r;t&&t.id;return e("debug",(function*debug(e){yield r.$debug})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("repl/host/exit",[],(function(e,t){"use strict";var r;t&&t.id;return e("exit",(function*exit(e){throw new r})),{setters:[],execute:function(){r=class ExitError extends Error{},e("ExitError",r)}}})),System.register("repl/host/load",["index","operators/operands","repl/signals"],(function(e,t){"use strict";var r,n,o;t&&t.id;return e("load",(function*load(e){const[t]=n.checkOperands(e,r.ValueType.string).map((e=>e.data)),s=yield o.$load;e.pop(),yield*e.innerParse(s,t)})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e}],execute:function(){}}})),System.register("repl/host/state",["repl/signals"],(function(e,t){"use strict";var r;t&&t.id;return e("state",(function*state(e){yield r.$state})),{setters:[function(e){r=e}],execute:function(){}}})),System.register("repl/host/index",["index","repl/host/debug","repl/host/exit","repl/host/load","repl/host/state"],(function(e,t){"use strict";var r,n,o,s,a,i;t&&t.id;return{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e},function(e){a=e}],execute:function(){i={debug:n.debug,exit:o.exit,load:s.load,state:a.state},e("hostDictionary",{get names(){return Object.keys(i)},lookup(e){const t=i[e];return void 0===t?null:{type:r.ValueType.operator,data:t}}})}}})),System.register("repl/status",["repl/colors"],(function(e,t){"use strict";var r,n;t&&t.id;function scaleBytes(e){for(const t of n)if(e>t.factor)return`${(e/t.factor).toFixed(2)}${t.unit}`;return`${e}B`}function memory(e){const{usedMemory:t,totalMemory:n}=e;return n===1/0?scaleBytes(t)+r.blue+"/\u221e"+r.white:scaleBytes(t)+r.blue+"/"+scaleBytes(n)+r.white}return e("memory",memory),e("status",(function status(e,t){let n;n=t.absolute?"cycle: #":"cycles: ";let o="";const{lastOperandsCount:s}=t;if(void 0!==s){const t=e.operands.length;t>s?o=` ${r.red}+${t-s}`:t<s&&(o=` ${r.red}-${s-t}`)}let a="";const{lastUsedMemory:i}=t;if(void 0!==i){const t=e.usedMemory;t>i?a=` ${r.red}+${scaleBytes(t-i)}`:t<i&&(a=` ${r.green}-${scaleBytes(i-t)}`)}return[`${r.cyan}${n}${r.yellow}${t.cycle}`,`${r.cyan}, operands: ${r.yellow}${e.operands.length}${o}`,`${r.cyan}, memory: ${r.yellow}${memory(e)}${a}`,r.white,t.concat,r.white].join("")})),{setters:[function(e){r=e}],execute:function(){n=[{factor:1048576,unit:"MB"},{factor:1024,unit:"kB"}]}}})),System.register("repl/impl",["repl/colors","repl/host/index","factory","repl/host/exit","errors/BaseError","repl/status","repl/signals","state/callstack","repl/forEach","formatters"],(function(e,t){"use strict";var r,n,o,s,a,i,c,u,l,p;t&&t.id;return e("main",(async function main(e,t){t&&e.output(`${r.green}DEBUG mode enabled`),e.output(`${r.cyan}Use '${r.yellow}exit${r.cyan}' to quit`),e.output(`${r.cyan}Use '${r.yellow}state${r.cyan}' to print a state summary`);const f=o.createState({hostDictionary:n.hostDictionary,keepDebugInfo:t});let d=0;for(;;){const t=await e.getInput();try{let n=f.operands.length,o=f.usedMemory,s=0,a=!1;const y=f.parse(t,"repl"+d++);let{done:h,value:m}=y.next();for(;!1===h;){let t;if(m===c.$state){const t=f.dictionaries.length;e.output(`${r.cyan}memory: ${r.yellow}${i.memory(f)}`),e.output(`${r.cyan}dictionaries: ${r.yellow}${t}`),l.forEach(f.dictionaries,((t,r)=>{e.output(`${r} ${p.formatters[t.type](t)}`)})),e.output(`${r.cyan}operands: ${r.yellow}${f.operands.length}`),l.forEach(f.operands,((t,n)=>{let o;const{sourceFile:s,sourcePos:a}=t;o=void 0===s||void 0===a?"":` ${r.blue}@${s}(${a.toString()})`,e.output(`${n} ${p.formatters[t.type](t)}${o}`)}))}else if(m===c.$debug)a=!0;else if(m===c.$load){const{data:r}=f.operands.at(0);t=await e.getSample(r)}if(a){e.output(u.renderCallStack(f.calls).replace(/\u00bb.*\u00ab/g,(e=>`${r.yellow}${e}${r.white}`)).replace(/@.*\n/g,(e=>`${r.blue}${e}${r.white}`)).replace(/\/!\\.*\n/g,(e=>`${r.red}${e}${r.white}`)).replace(/\u2026|\u21b5|\u2b72/g,(e=>`${r.blue}${e}${r.white}`))),e.output(i.status(f,{cycle:s,absolute:!0,lastOperandsCount:n,lastUsedMemory:o,concat:`${r.cyan}, ${r.yellow}c${r.cyan}ontinue, ${r.yellow}q${r.cyan}uit`})),n=f.operands.length,o=f.usedMemory;"q"===await e.getChar()&&(a=!1)}++s;const d=y.next(t);h=d.done,m=d.value}e.output(i.status(f,{cycle:s,absolute:!1,lastOperandsCount:n,lastUsedMemory:o}))}catch(t){if(t instanceof s.ExitError)break;if(!(t instanceof a.BaseError)){e.output(`${r.red}${t.toString()}`);break}e.output(`${r.red}/!\\ ${t.name}: ${t.message}\n${t.callstack}`)}}})),{setters:[function(e){r=e},function(e){n=e},function(e){o=e},function(e){s=e},function(e){a=e},function(e){i=e},function(e){c=e},function(e){u=e},function(e){l=e},function(e){p=e}],execute:function(){}}}));