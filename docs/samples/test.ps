"describe" {
  {
    globaldict "_tests" get
    type "dicttype" neq
    {
      mark
        "name" "describe_fail"
        "message" "_tests is not a dictionary"
      dicttomark
      throw
    }
    if
  }
  {
    dup "name" get "Undefined" eq
    {
      pop
      globaldict
      "_tests"
      mark
        "content" []
        "stack" []
      dicttomark
      set
    }
    {
      throw
    }
    ifelse
  }
  catch

  dict begin % stack a context dictionary

  "check_name_and_block" {
    dup type "blocktype" neq { typecheck } if
    1 index type "stringtype" neq { typecheck } if
  } bind def

  "get_current_content" {
    globaldict "_tests" get
    "stack" get
    dup length 1 sub get
    "content" get
  }

  "it" {
    check_name_and_block

    get_current_content

    mark
      "type" "it"
      "name" 4 -1 roll
      "block" 5 -1 roll
    dicttomark

    apush

  } bind def

  {
    check_name_and_block

    dict begin % stack describe dictionary
    {
      get_current_content

      mark
        "type" "describe"
        "name" 4 -1 roll
        "content" []
      dicttomark

      apush

      true exch if % execute block
    }
    {
      end % unstack describe dictionary
    }
    finally

    currentdict

  } bind
  {
    end % unstack context dictionary
  } finally

} bind def

"run_all_tests" {

} bind def