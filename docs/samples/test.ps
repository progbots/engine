dict begin % stack a context dictionary
{
  "describe" where 
  {

  } if

  "root_content" mark "content" [] dicttomark def
  "content_stack" [ root_content ] def

  "check_name_and_block" {
    dup type "blocktype" neq { typecheck } if
    1 index type "stringtype" neq { typecheck } if
  } bind def

  "get_current_content" {
    content_stack
    dup length 1 sub get
    "content" get
  } bind def

  "it" {
    check_name_and_block
    get_current_content
    mark
      "type" "it"
      "name" 4 -1 roll
      "block" 5 -1 roll
    dicttomark
    apush
  } bind def

  globaldict "describe" {
    check_name_and_block
    mark
      "type" "describe"
      "name" 4 -1 roll
      "content" []
    dicttomark
    get_current_content 1 index apush
    content_stack get exch apush
    {
      true exch if % execute block
    }
    {
      tests "stack" get apop pop
    }
    finally
  } bind set



  globaldict "run_all_tests" {
    tests ""

  } bind set
}
{
  end % unstack context dictionary
}
finally 
